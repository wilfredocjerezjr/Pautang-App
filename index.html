<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#eff6ff">
    
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Pautang Pro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="BIR Compliant Lending App">
    
    <title>Pautang App Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- LINK TO CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app-root">

    <header>
        <h1>Pautang App <span style="font-size:0.6em; vertical-align:middle; background:#dcfce7; color:#166534; padding:2px 6px; border-radius:4px; margin-left:5px;">PRO</span></h1>
    </header>

    <!-- SAFETY BANNER -->
    <div id="safetyBanner">
        <span>‚ö†Ô∏è Save to Phone Storage para SAFE.</span>
        <button onclick="exportData()">SAVE NOW</button>
    </div>

    <!-- VIEW 1: HOME -->
    <div id="view-home" class="view-section active">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-bar" placeholder="Maghanap..." onkeyup="filterHomeList()">
            <select id="filterSelect" class="filter-select" onchange="filterHomeList()">
                <option value="all">Lahat</option>
                <option value="due">Due Soon</option>
                <option value="overdue">Overdue</option>
                <option value="paid">Paid</option>
            </select>
        </div>

        <div class="section-title">Priority List</div>
        <div id="homeListContent"></div>
        <button id="seeMoreBtn" class="btn-block btn-see-more hidden" onclick="showAllProfiles()">Load All Profiles</button>
        <button class="fab" onclick="openProfileModal()">+</button>
    </div>

    <!-- VIEW 2: DASHBOARD -->
    <div id="view-dashboard" class="view-section">
        <h2 style="margin-top:0; margin-bottom:20px;">Dashboard Overview</h2>
        <div class="dashboard-grid">
            <div class="stat-card clock-container">
                <span class="stat-val" id="liveClock">--:--:--</span>
                <span class="stat-label">System Time</span>
            </div>
            <div class="stat-card stat-receivable">
                <span class="stat-val" id="totalReceivables">‚Ç±0</span>
                <span class="stat-label">Sisingilin</span>
            </div>
            <div class="stat-card stat-collected">
                <span class="stat-val" id="totalCollected">‚Ç±0</span>
                <span class="stat-label">Nasingil</span>
            </div>
        </div>
    </div>

    <!-- VIEW 3: BOOKS OF ACCOUNTS -->
    <div id="view-books" class="view-section">
        <h2 style="margin-top:0; margin-bottom:20px;">Books of Accounts</h2>
        
        <div class="books-nav">
            <button class="book-tab active" onclick="switchBook('crj', this)">Cash Receipts</button>
            <button class="book-tab" onclick="switchBook('cdj', this)">Disbursements</button>
            <button class="book-tab" onclick="switchBook('gj', this)">General Journal</button>
            <button class="book-tab" onclick="switchBook('gl', this)">General Ledger</button>
        </div>

        <div class="book-container">
            <div class="book-table-wrapper">
                <table class="book-table" id="bookTableContent">
                    <!-- Dynamic Content -->
                </table>
            </div>
        </div>
        <p style="font-size:0.8rem; color:#999; margin-top:10px; text-align:center;">* Auto-generated based on BIR Standards.</p>
    </div>
        <!-- VIEW 4: TOOLS -->
    <div id="view-tools" class="view-section">
        <h2 style="margin-top:0; margin-bottom:20px;">Tools & Export</h2>
        
        <!-- PWA INSTALLER -->
        <div id="installAppCard" class="tool-card" style="background:#dbeafe; border-color:#93c5fd; display:none;" onclick="installPWA()">
            <div class="tool-icon" style="background:#2563eb; color:white;">‚¨áÔ∏è</div>
            <div class="tool-info"><h3 style="color:#1e40af;">Install App</h3><p>Gawing totoong app</p></div>
        </div>

        <div class="tools-grid">
            <div class="tool-card" onclick="openExportModal()" style="background:#f0fdf4; border-color:#22c55e;">
                <div class="tool-icon">üìä</div>
                <div class="tool-info"><h3 style="color:#15803d;">Export Records</h3><p>Download Excel/CSV</p></div>
            </div>

            <div class="tool-card" onclick="openTutorialModal()">
                <div class="tool-icon" style="background:#fef3c7; color:#d97706;">üìñ</div>
                <div class="tool-info"><h3>App Tutorial</h3><p>Guide</p></div>
            </div>
            
            <div class="tool-card" onclick="exportData()">
                <div class="tool-icon" style="background:#dbeafe; color:#2563eb;">üíæ</div>
                <div class="tool-info"><h3>Save to Storage</h3><p>Backup (Safety)</p></div>
            </div>
            
            <div class="tool-card" onclick="triggerRestore()">
                <div class="tool-icon" style="background:#f3e8ff; color:#7c3aed;">üìÇ</div>
                <div class="tool-info"><h3>Open Database</h3><p>Restore File</p></div>
            </div>

            <div class="tool-card" onclick="openModal('loanCalcModal')">
                <div class="tool-icon" style="background:#ecfdf5; color:#10b981;">üßÆ</div>
                <div class="tool-info"><h3>Calculator</h3><p>Interest</p></div>
            </div>
            
            <div class="tool-card" onclick="openModal('dateCalcModal')">
                <div class="tool-icon" style="background:#eff6ff; color:#3b82f6;">üìÖ</div>
                <div class="tool-info"><h3>Due Date</h3><p>Finder</p></div>
            </div>
            
            <div class="tool-card" onclick="openCollectionModal()">
                <div class="tool-icon" style="background:#fff7ed; color:#f97316;">üìã</div>
                <div class="tool-info"><h3>Collection</h3><p>Listahan</p></div>
            </div>
            
            <input type="file" id="restoreFile" accept=".json,application/json" style="display:none;" onchange="handleRestore(this)">
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchView('home', this)">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 01-1 1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg> Home
        </button>
        <button class="nav-item" onclick="switchView('dashboard', this)">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg> Dash
        </button>
        <button class="nav-item" onclick="switchView('books', this)">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg> Books
        </button>
        <button class="nav-item" onclick="switchView('tools', this)">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg> Tools
        </button>
    </nav>

    </div>

    <!-- TOAST -->
    <div id="toast">Notification</div>

    <!-- MODAL: ADD/EDIT -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal-content">
            <h2 id="modalTitle">New Borrower</h2>
            <form id="profileForm" onsubmit="handleSaveProfile(event)">
                <input type="hidden" id="p_id">
                <div class="form-group" style="text-align: center;">
                    <img id="p_preview" src="" class="avatar" style="width:100px; height:100px; margin:auto; display:none;">
                    <label class="btn-secondary" style="display:inline-block; padding:8px 20px; border-radius:20px; margin-top:10px; cursor:pointer;">
                        üì∏ Upload Photo
                        <input type="file" style="display:none" accept="image/*" onchange="handleImageUpload(this)">
                    </label>
                    <input type="hidden" id="p_photo_base64">
                </div>
                <div class="form-group"><label>Name</label><input type="text" id="p_name" required></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="p_phone" required></div>
                <div class="form-group"><label>Address</label><input type="text" id="p_address"></div>
                <div class="form-group"><label>Terms</label>
                    <select id="p_terms" onchange="autoCalcDueDateInForm()">
                        <option value="Daily">Daily</option>
                        <option value="Weekly">Weekly</option>
                        <option value="Kinsenas">Kinsenas</option>
                        <option value="Monthly">Monthly</option>
                    </select>
                </div>
                <div class="form-group"><label>Loan Date</label><input type="date" id="p_loanDate" onchange="autoCalcDueDateInForm()"></div>
                <div class="form-group"><label>Next Due (Auto)</label><input type="text" id="p_dueDateDisplay" class="input-readonly" readonly></div>
                
                <button type="submit" class="btn-block btn-primary">SAVE RECORD</button>
                <button type="button" class="btn-block btn-secondary" onclick="closeModal('profileModal')">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- MODAL: DETAILS -->
    <div class="modal-overlay" id="detailsModal">
        <div class="modal-content">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
                <img id="d_avatar" class="avatar" style="width:80px; height:80px;">
                <div><h2 id="d_name" style="margin:0;"></h2><div id="d_contact" style="color:#64748b;"></div></div>
            </div>
            
            <div style="background:#f0f9ff; padding:20px; border-radius:16px; text-align:center; border:1px solid #bae6fd; margin-bottom:20px;">
                <label>Outstanding Balance</label>
                <div id="d_balance" style="font-size:2.2rem; font-weight:800; color:#0369a1;"></div>
                <div id="d_due_date" style="font-size:0.9rem; color:#dc2626; font-weight:600;"></div>
            </div>

            <!-- ANALYZE BUTTON -->
            <button class="btn-block btn-primary" onclick="analyzeBorrower()" style="margin-bottom: 20px; background: linear-gradient(135deg, #a855f7, #ec4899);">‚ú® ANALYZE RISK (AI)</button>
            <div id="aiAnalysisResult" class="ai-result-box"></div>

            <h3>Transactions</h3>
            <form onsubmit="handleAddTransaction(event)">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <select id="t_type" style="flex:1;"><option value="Payment">Payment</option><option value="Loan">New Loan</option></select>
                    <input type="number" id="t_amount" placeholder="Amount" style="flex:1;" required step="0.01">
                </div>
                <input type="text" id="t_notes" placeholder="Notes" style="margin-bottom:10px;">
                <button type="submit" class="btn-block btn-primary">SUBMIT</button>
            </form>

            <div style="margin-top:20px; max-height:200px; overflow-y:auto;">
                <table style="width:100%; font-size:0.9rem;">
                    <thead><tr style="text-align:left; color:#64748b;"><th>Date</th><th>Type</th><th>Amt</th></tr></thead>
                    <tbody id="transList"></tbody>
                </table>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
                <button class="btn-block btn-secondary" onclick="editCurrentProfile()">EDIT</button>
                <button class="btn-block btn-secondary" onclick="closeModal('detailsModal')">CLOSE</button>
            </div>
            <button class="btn-block btn-danger" onclick="deleteCurrentProfile()" style="margin-top:10px;">DELETE</button>
        </div>
    </div>

    <!-- DIGITAL RECEIPT -->
    <div class="modal-overlay" id="receiptModal">
        <div class="modal-content">
            <h2 style="text-align:center; color: var(--success);">Success</h2>
            <div class="receipt-paper">
                <div class="receipt-header">PAYMENT RECEIPT</div>
                <div class="receipt-row"><span>Date:</span> <span id="r_date"></span></div>
                <div class="receipt-row"><span>Name:</span> <span id="r_name"></span></div>
                <div class="receipt-row"><span>Paid:</span> <span id="r_amount" style="font-weight:bold;"></span></div>
                <div class="receipt-total"><span>Balance:</span> <span id="r_balance"></span></div>
            </div>
            <button class="btn-block btn-primary" onclick="closeReceipt()">OK</button>
        </div>
    </div>

    <!-- MODAL: EXPORT -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal-content">
            <h2>üìä Export Records</h2>
            <div class="form-group">
                <label>Select Book</label>
                <select id="export_type">
                    <option value="CRJ">Cash Receipts (CRJ)</option>
                    <option value="CDJ">Disbursements (CDJ)</option>
                    <option value="GL">General Ledger (GL)</option>
                    <option value="GJ">General Journal (GJ)</option>
                </select>
            </div>
            <div class="form-group"><label>From Date</label><input type="date" id="exp_start"></div>
            <div class="form-group"><label>To Date</label><input type="date" id="exp_end"></div>
            <button class="btn-block btn-primary" onclick="runExport()">DOWNLOAD CSV</button>
            <button class="btn-block btn-secondary" onclick="closeModal('exportModal')">CLOSE</button>
        </div>
    </div>

    <!-- SMS MODAL -->
    <div class="modal-overlay" id="smsModal">
        <div class="modal-content" style="border-top: 6px solid #ef4444;">
            <h2 style="color:#b91c1c;">Payment Notice</h2>
            <div class="form-group"><label>Outstanding Balance</label><input type="text" id="s_balance" readonly></div>
            <div class="form-group">
                <label>Penalty (%)</label>
                <div style="display:flex; align-items:center; gap:10px;"><input type="number" id="s_penalty" value="0" oninput="calculateSMS()" style="width:80px;"><span id="s_status" style="font-size:0.85rem;"></span></div>
            </div>
            <div class="form-group"><label>Total Due</label><input type="text" id="s_total" readonly style="font-weight:800; color:#dc2626;"></div>
            
            <div class="form-group" style="background: #fdf4ff; padding: 12px; border-radius: 12px;">
                <label style="color:#86198f;">‚ú® AI Composer</label>
                <div style="display:flex; gap:8px;">
                    <select id="s_ai_tone" style="flex:1;"><option value="Polite">Mabait</option><option value="Serious">Seryoso</option></select>
                    <button type="button" class="btn-block" style="background:#d946ef; color:white; width:auto; padding:0 20px; margin:0;" onclick="generateAISMS()">Draft</button>
                </div>
            </div>

            <div class="form-group"><label>Message Preview</label><textarea id="s_message" class="msg-preview" rows="4"></textarea></div>
            <div style="display:flex; gap:10px; flex-direction:column;"><button class="btn-block btn-secondary" onclick="copySMS()">üìã COPY</button><button id="smsDirectBtn" type="button" class="btn-block btn-sms" onclick="safeOpenSMS()">üì© OPEN SMS</button></div>
            <button class="btn-block btn-secondary" onclick="closeModal('smsModal')">CANCEL</button>
        </div>
    </div>

    <!-- UTILS MODALS -->
    <div class="modal-overlay" id="loanCalcModal"><div class="modal-content"><h2>Loan Calculator</h2><input id="c_P" type="number" placeholder="Principal" class="form-group"><input id="c_R" type="number" placeholder="Interest %" class="form-group"><input id="c_D" type="number" placeholder="Duration (Days)" class="form-group"><button class="btn-block btn-primary" onclick="calcLoan()">COMPUTE</button><div id="c_res" class="calc-result-box"></div><button class="btn-block btn-secondary" onclick="closeModal('loanCalcModal')">CLOSE</button></div></div>
    <div class="modal-overlay" id="dateCalcModal"><div class="modal-content"><h2>Due Date Finder</h2><input id="dc_start" type="date" class="form-group"><input id="dc_add" type="number" placeholder="Days to add" class="form-group"><button class="btn-block btn-primary" onclick="calcDate()">FIND</button><div id="dc_res" class="date-result-box"></div><button class="btn-block btn-secondary" onclick="closeModal('dateCalcModal')">CLOSE</button></div></div>
    <div class="modal-overlay" id="collectionListModal"><div class="modal-content"><h2>Collection List</h2><textarea id="cl_txt" style="width:100%; height:150px; padding:10px;"></textarea><button class="btn-block btn-primary" onclick="copyCL()">COPY</button><button class="btn-block btn-secondary" onclick="closeModal('collectionListModal')">CLOSE</button></div></div>
    
    <!-- TUTORIAL -->
    <div class="modal-overlay" id="tutorialModal">
        <div class="modal-content" style="height:80vh; display:flex; flex-direction:column; padding:0;">
            <div style="padding:25px;"><h2 style="margin-top:0;">üìñ Guide</h2><div class="tutorial-tabs"><div class="tut-tab active" onclick="switchTutTab('intro', this)">Basics</div><div class="tut-tab" onclick="switchTutTab('trans', this)">Transact</div><div class="tut-tab" onclick="switchTutTab('data', this)">SAFETY</div></div></div>
            <div style="flex:1; overflow-y:auto; padding:0 25px;">
                <div id="tut-intro" class="tut-content active"><div class="tut-step"><h4>Info</h4><p>Offline App ito. Ang data ay nasa phone mo.</p></div></div>
                <div id="tut-trans" class="tut-content"><div class="tut-step"><h4>Bayad</h4><p>Piliin ang profile -> Payment. May resibo.</p></div></div>
                <div id="tut-data" class="tut-content"><div class="tut-step"><h4 style="color:red;">‚ö†Ô∏è MAHALAGA: BACKUP</h4><p>Dahil browser-based ito, mabubura ang data pag nag-clear cache ka. <br><br><b>SOLUSYON:</b> Laging pindutin ang <b>Save to Storage</b> sa Tools. Mase-save ito sa Downloads folder mo. Kahit ma-clear cache, pwede mo i-Restore.</p></div></div>
            </div>
            <div style="padding:15px 25px;"><button class="btn-block btn-secondary" onclick="closeModal('tutorialModal')">CLOSE</button></div>
        </div>
    </div>

    <!-- LINK SCRIPTS -->
    <script src="script.js"></script>
</body>
    </html>
                            
