<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pautang App PRO</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="header-left">
            <div class="brand-text">PAUTANG APP</div>
            <div class="brand-badge">PRO</div>
        </div>
        <div class="notif-box">
            <i class="ph-bold ph-bell" style="font-size:24px; color:var(--text-dark);"></i>
            <div class="notif-badge" id="notif-count" style="display:none;">0</div>
        </div>
    </header>

    <!-- SAFETY BANNER -->
    <div class="safety-banner">
        <div><i class="ph-fill ph-warning" style="margin-right:4px;"></i> Keep data safe.</div>
        <button class="btn-banner" onclick="app.exportBackup()">BACKUP NOW</button>
    </div>

    <!-- MAIN CONTENT -->
    <main>
        
        <!-- === HOME VIEW === -->
        <div id="view-home" class="view active">
            <div class="search-row">
                <input type="text" id="search-input" class="search-input-style" placeholder="Maghanap..." onkeyup="app.renderHome()">
                <select id="filter-select" class="search-input-style" onchange="app.renderHome()">
                    <option value="all">Lahat</option>
                    <option value="active">Active</option>
                    <option value="paid">Paid</option>
                </select>
            </div>

            <div class="section-title">
                <span id="home-list-title">PRIORITY 4 LIST</span>
            </div>

            <div id="borrower-list">
                <!-- Dynamic Content -->
            </div>

            <button id="btn-see-more" class="btn-see-more" style="display:none;" onclick="app.showFullList()">
                See All Borrowers...
            </button>

            <div id="empty-state" class="empty-state">
                <p>No records found.</p>
                <button class="btn-restore" onclick="document.getElementById('restore-input-home').click()">
                    <i class="ph-bold ph-arrow-counter-clockwise"></i> RESTORE FROM BACKUP
                </button>
                <input type="file" id="restore-input-home" hidden accept=".json" onchange="app.importBackup(this)">
            </div>
        </div>

        <!-- === DASHBOARD VIEW === -->
        <div id="view-dash" class="view">
            <h2 class="section-title">Dashboard Overview</h2>
            
            <div class="glass-card dash-card-lg">
                <div class="dash-time" id="system-time">--:--:--</div>
                <div class="dash-label">SYSTEM TIME</div>
            </div>

            <div class="stats-grid">
                <div class="glass-card dash-card-sm" style="border-top-color: var(--danger);">
                    <div class="stat-val text-red" id="dash-receivables">₱0</div>
                    <div class="dash-label">SISINGILIN</div>
                </div>
                <div class="glass-card dash-card-sm" style="border-top-color: var(--success);">
                    <div class="stat-val text-green" id="dash-collected">₱0</div>
                    <div class="dash-label">NASINGIL</div>
                </div>
            </div>
        </div>

        <!-- === BOOKS VIEW === -->
        <div id="view-books" class="view">
            <h2 class="section-title">Books of Accounts</h2>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="app.setBookTab('receipts')">Cash Receipts</button>
                <button class="tab-btn" onclick="app.setBookTab('disbursements')">Disbursements</button>
                <button class="tab-btn" onclick="app.setBookTab('general')">General</button>
            </div>

            <div class="glass-card books-header">
                <div>Date</div>
                <div>Payer</div>
                <div>Ref</div>
                <div>Amt</div>
            </div>
            
            <div id="books-table-body" class="glass-card" style="padding:0; overflow:hidden;">
                <!-- Rows -->
            </div>
            
            <div style="text-align:center; font-size:10px; color:var(--text-gray); margin-top:20px; opacity:0.7;">
                * Auto-generated based on BIR Standards.
            </div>
        </div>

        <!-- === TOOLS VIEW === -->
        <div id="view-tools" class="view">
            <h2 class="section-title">Tools & Export</h2>
            
            <div class="tools-list">
                <div class="glass-card tool-item" onclick="app.exportCSV()">
                    <div class="tool-icon-box bg-green"><i class="ph-bold ph-chart-bar"></i></div>
                    <div class="tool-content"><h4>Export Records</h4><p>Download Excel/CSV</p></div>
                </div>

                <div class="glass-card tool-item" onclick="app.toggleModal('modal-tutorial', true)">
                    <div class="tool-icon-box bg-yellow"><i class="ph-bold ph-book-open"></i></div>
                    <div class="tool-content"><h4>App Tutorial</h4><p>User Manual</p></div>
                </div>

                <div class="glass-card tool-item" onclick="app.exportBackup()">
                    <div class="tool-icon-box bg-blue"><i class="ph-bold ph-floppy-disk"></i></div>
                    <div class="tool-content"><h4>Save to Storage</h4><p>Backup (Safety)</p></div>
                </div>

                <div class="glass-card tool-item" onclick="document.getElementById('restore-input-tool').click()">
                    <div class="tool-icon-box bg-gray"><i class="ph-bold ph-folder-open"></i></div>
                    <div class="tool-content"><h4>Restore Data</h4><p>Ibalik galing backup</p></div>
                    <input type="file" id="restore-input-tool" hidden accept=".json" onchange="app.importBackup(this)">
                </div>

                <div class="glass-card tool-item" onclick="app.toggleModal('modal-calc', true)">
                    <div class="tool-icon-box bg-teal"><i class="ph-bold ph-calculator"></i></div>
                    <div class="tool-content"><h4>Calculator</h4><p>Interest</p></div>
                </div>
            </div>
        </div>

                        </main>
                    <!-- FAB -->
    <button id="fab" class="fab" onclick="app.openCreateModal()">
        <i class="ph-bold ph-plus"></i>
    </button>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="app.navTo('home', this)">
            <i class="ph-bold ph-house"></i><span>Home</span>
        </div>
        <div class="nav-item" onclick="app.navTo('dash', this)">
            <i class="ph-bold ph-chart-bar"></i><span>Dash</span>
        </div>
        <div class="nav-item" onclick="app.navTo('books', this)">
            <i class="ph-bold ph-book-bookmark"></i><span>Books</span>
        </div>
        <div class="nav-item" onclick="app.navTo('tools', this)">
            <i class="ph-bold ph-gear"></i><span>Tools</span>
        </div>
    </nav>

    <!-- === MODAL: NEW/EDIT BORROWER === -->
    <div id="modal-new-borrower" class="modal-overlay">
        <div class="modal-sheet">
            <h2 id="modal-new-borrower-title" style="font-size:22px; font-weight:800; margin-bottom:24px; color:var(--text-dark);">New Borrower</h2>
            
            <div class="photo-placeholder" onclick="document.getElementById('nb-photo-input').click()" id="nb-photo-preview">
                <i class="ph-bold ph-camera"></i>
            </div>
            <input type="file" id="nb-photo-input" hidden accept="image/*" onchange="app.handleImageUpload(this)">

            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="nb-name" placeholder="e.g. Juan Dela Cruz">
            </div>

            <div class="form-group">
                <label>Mobile Number</label>
                <input type="tel" id="nb-mobile" placeholder="09xxxxxxxxx">
            </div>

             <div class="form-group" id="group-amount">
                <label>Principal Amount (₱)</label>
                <input type="number" id="nb-amount" placeholder="0.00">
            </div>

            <!-- NEW FIELDS FOR RATES -->
            <div class="form-group" id="group-rates" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div>
                    <label>Interest (%)</label>
                    <input type="number" id="nb-interest" placeholder="5">
                </div>
                <div>
                    <label>Penalty (%)</label>
                    <input type="number" id="nb-penalty" placeholder="2">
                </div>
            </div>

            <div class="form-group">
                <label>Payment Terms</label>
                <select id="nb-terms" onchange="app.calculateNextDue()">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>

            <div class="form-group" id="group-date">
                <label>Loan Date</label>
                <input type="date" id="nb-date" onchange="app.calculateNextDue()">
            </div>

            <div class="form-group" id="group-nextdue">
                <label>Next Due Date (Auto)</label>
                <input type="text" id="nb-nextdue" readonly style="background:#e2e8f0; cursor: not-allowed; color:#64748b;">
            </div>

            <div style="flex:1"></div>

            <button class="btn-block btn-primary" onclick="app.saveBorrower()">SAVE RECORD</button>
            <button class="btn-block btn-cancel" onclick="app.toggleModal('modal-new-borrower', false)">CANCEL</button>
        </div>
    </div>

    <!-- === MODAL: DELETE CONFIRMATION === -->
    <div id="modal-delete-confirm" class="modal-overlay" style="z-index: 300;">
        <div class="modal-sheet" style="height: auto;">
            <h3 style="font-size: 20px; font-weight: 800; color: var(--danger); margin-bottom: 10px; text-align: center;">Delete Profile?</h3>
            <p style="text-align: center; color: var(--text-gray); font-size: 14px; margin-bottom: 20px;">
                Are you sure you want to delete this profile? This action cannot be undone.
            </p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <button class="btn-block btn-cancel" style="margin-top:0;" onclick="app.toggleModal('modal-delete-confirm', false)">NO</button>
                <button class="btn-block btn-danger" style="margin-top:0;" onclick="app.executeDelete()">YES, DELETE</button>
            </div>
        </div>
    </div>

    <!-- === MODAL: BORROWER DETAILS HUB (UPDATED FOR LIST) === -->
    <div id="modal-borrower-details" class="modal-overlay">
        <div class="modal-sheet" style="height: 95vh;">
            <div class="details-header">
                <div class="details-avatar" id="bd-avatar">J</div>
                <h2 id="bd-name" style="font-size: 20px; margin-bottom: 5px;">Juan Dela Cruz</h2>
                <div class="details-label">Total Outstanding Balance</div>
                <div class="details-balance" id="bd-balance">₱0.00</div>
            </div>

            <!-- Add Loan Button (Always Visible) -->
            <button class="btn-block btn-primary" style="margin-bottom:20px;" onclick="app.prepareTransaction('disbursement')">
                <i class="ph-bold ph-plus-circle"></i> NEW LOAN
            </button>

            <div class="history-section">
                <h4>Active Loans</h4>
                <div id="bd-loan-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Dynamic Loan Cards -->
                </div>
            </div>

            <div style="flex:1"></div>
            <button class="btn-block btn-primary" style="background: linear-gradient(135deg, #a78bfa, #818cf8); margin-bottom: 10px;" onclick="app.editBorrower()">EDIT PROFILE</button>
            <button class="btn-block btn-danger" style="margin-bottom:10px; background:#ef4444;" onclick="app.deleteBorrower()">DELETE PROFILE</button>
            <button class="btn-block btn-cancel" onclick="app.toggleModal('modal-borrower-details', false)">CLOSE</button>
        </div>
    </div>

    <!-- === MODAL: TRANSACTION INPUT === -->
    <div id="modal-transact" class="modal-overlay" style="z-index: 210;">
        <div class="modal-sheet" style="height: auto;">
            <h2 id="transact-title" style="margin-bottom: 20px;">Record Transaction</h2>
            <div class="form-group">
                <label>Amount (₱)</label>
                <input type="number" id="transact-amount" placeholder="0.00" style="font-size: 24px; text-align: center;">
            </div>
            <button class="btn-block btn-primary" onclick="app.executeTransaction()">CONFIRM</button>
            <button class="btn-block btn-cancel" onclick="app.toggleModal('modal-transact', false)">CANCEL</button>
        </div>
    </div>

    <!-- === MODAL: RECEIPT (NEW) === -->
    <div id="modal-receipt" class="modal-overlay" style="z-index: 220;">
        <div class="modal-sheet" style="height: auto; background: transparent; box-shadow: none;">
            <div class="receipt-paper">
                <h3 style="color:var(--primary); margin-bottom: 5px;">PAYMENT SUCCESSFUL</h3>
                <p style="font-size:11px; color:gray; margin-bottom:20px;">TRANSACTION RECEIPT</p>
                
                <div class="receipt-amount" id="rcpt-amount">₱0.00</div>
                
                <div class="receipt-row"><span>Date</span><span id="rcpt-date">--</span></div>
                <div class="receipt-row"><span>Time</span><span id="rcpt-time">--</span></div>
                <div class="receipt-row"><span>Payer</span><span id="rcpt-name">--</span></div>
                <div class="receipt-row"><span>Reference</span><span id="rcpt-ref">--</span></div>
                <hr style="border-top:1px dashed #e2e8f0; margin: 15px 0;">
                <div class="receipt-row"><span>Remaining Balance</span><span id="rcpt-bal" style="color:var(--danger)">--</span></div>
                
                <button class="btn-block btn-primary" style="margin-top:20px;" onclick="app.toggleModal('modal-receipt', false)">CLOSE RECEIPT</button>
            </div>
        </div>
    </div>

    <!-- === MODAL: CALCULATOR === -->
    <div id="modal-calc" class="modal-overlay">
        <div class="modal-sheet" style="height:auto;">
            <h2 style="font-size:22px; font-weight:800; margin-bottom:20px;">Interest Calculator</h2>
            <div class="form-group"><label>Principal</label><input type="number" id="calc-p"></div>
            <div class="form-group"><label>Rate (%)</label><input type="number" id="calc-r"></div>
            <div class="form-group"><label>Days</label><input type="number" id="calc-d"></div>
            <div style="background:#f1f5f9; border-radius:16px; padding:20px; margin:10px 0;">
                <div class="calc-result-row"><span class="calc-label">Interest</span><span class="calc-value" id="calc-result-interest">₱0.00</span></div>
                <div class="calc-result-row" style="border:none;"><span class="calc-label">Total</span><span class="calc-value calc-total" id="calc-result-total">₱0.00</span></div>
            </div>
            <button class="btn-block btn-primary" onclick="app.runCalculator()">CALCULATE</button>
            <button class="btn-block btn-cancel" onclick="app.toggleModal('modal-calc', false)">CLOSE</button>
        </div>
    </div>

    <!-- === MODAL: TUTORIAL === -->
    <div id="modal-tutorial" class="modal-overlay">
        <div class="modal-sheet">
            <h2 style="font-size:20px; font-weight:800; margin-bottom:20px;">User Manual</h2>
            <div class="tutorial-step"><h4>1. How to Create a New Loan</h4><p>Go to Home, tap (+). Enter details including Interest Rate. Each loan is tracked separately.</p></div>
            <div class="tutorial-step"><h4>2. How to Pay</h4><p>Tap a Borrower. You will see a list of loans. Click the "PAY" button specific to the loan you want to pay.</p></div>
            <div class="tutorial-step"><h4>3. Penalty Logic</h4><p>If a loan passes its due date, the penalty rate is automatically added to the Total Due.</p></div>
            <div class="tutorial-step" style="border-bottom:none;"><h4>4. SAFETY</h4><p>Use Tools > Save to Storage to backup your data daily.</p></div>
            <button class="btn-block btn-primary" onclick="app.toggleModal('modal-tutorial', false)">CLOSE MANUAL</button>
        </div>
    </div>

    <!-- TOAST ELEMENT -->
    <div id="toast" class="toast">Data Saved. Backup Recommended.</div>

    <script src="script.js"></script>
</body>
    </html>
    
